{pkgs, ...}:

{
  services.autorandr.enable = true;
  services.autorandr.defaultTarget = "fallback";
  services.autorandr.profiles = {    
    "default" = {
      fingerprint = {
        eDP = "00ffffffffffff000e6f001600000000001e0104b522167803ee95a3544c99260f5054000000010101010101010101010101010101016e6e00a0a04084603020360059d710000018000000fd0c3ca51f1f4e010a202020202020000000fe0043534f542054330a2020202020000000fe004d4e473030374441312d310a20010302031d00e3058000e60605016a6a246d1a000002033ca500046a246a240000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ff";
        DP-1-2 = "00ffffffffffff0010ac62a24233593402220104a5351e783a4cb5aa534fa1240f5054a54b00714f8180a9c0d1c081c081cf01010101023a801871382d40582c45000f282100001e000000ff003537384b3631340a2020202020000000fc0044454c4c205032343235480a20000000fd0030641e6e17010a2020202020200144020311b149901f04131203110201e200ea605980a070381440302035000f282100001a000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000069";
      };
      config = {
        eDP.enable = false;
        DP-1-2 = {
          enable = true;
          crtc = 0;
          primary = true;
          position = "0x0";
          mode = "1920x1080";
          gamma = "1.0:1.0:1.0";
          rate = "60.00";
        };
      };
    };

    "fallback" = {
      fingerprint = {
        eDP = "00ffffffffffff000e6f001600000000001e0104b522167803ee95a3544c99260f5054000000010101010101010101010101010101016e6e00a0a04084603020360059d710000018000000fd0c3ca51f1f4e010a202020202020000000fe0043534f542054330a2020202020000000fe004d4e473030374441312d310a20010302031d00e3058000e60605016a6a246d1a000002033ca500046a246a240000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ff";
      };
      config = {
        eDP = {
          enable = true;
          crtc = 0;
          primary = true;
          position = "0x0";
          mode = "2560x1600";
          gamma = "1.0:1.0:1.0";
          rate = "60.00";
        };
      };
    };
  };
  services.autorandr.hooks = {
    postswitch = {
      "notify-i3" = "${pkgs.i3}/bin/i3-msg-restart";
      "change-dpi" = ''
        case "$AUTORANDR_CURRENT_PROFILE" in
          fallback)
            DPI=144
            ;;
          default)
            DPI=96
            ;;
          *)
          echo "Unknown profle: $AUTORANDR_CURRENT_PROFILE"
          exit 1
        esac
        echo "Xft.dpi: $DPI" | ${pkgs.xorg.xrdb}/bin/xrdb -merge
      '';
    };
  };
}